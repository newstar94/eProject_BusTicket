@model IEnumerable<eProject_BusTicket.ViewModels.TripSVM>

@{
    ViewBag.Title = "Index";
}

<form action="/TripSchedules/Index" method="post" class="search">
    <div class="search_from">
        <i class="fas fa-map-marker-alt"></i> From:
        @Html.DropDownList("Origin", ViewBag.Location as SelectList, "Select Origin")
    </div>
    <i class="fas fa-arrow-right"></i>
    <div class="search_to">
        <i class="fas fa-map-marker-alt"></i> To:
        @Html.DropDownList("Destination", ViewBag.Location as SelectList, "Select Destination")
    </div>
    <div class="search_date">
        <i class="far fa-calendar-alt"></i> Date:
        <input name="dateTime" type="date" min="@DateTime.Now.Date.ToString("yyyy-MM-dd")" required />
    </div>
    <button type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i>
    </button>
</form>


    <table id="triptable" class="table">
        <tr>
            <th>
                Trip Code
            </th>
            <th>
                Departure Time
            </th>
            <th>
                Origin
            </th>
            <th>
                Destination
            </th>
            <th>
                Type
            </th>
            <th>
                Vehicle Code
            </th>
            <th>
                Distance
            </th>
            <th>
                Time
            </th>
            <th>
                Stations
            </th>
            <th></th>
        </tr>
    @if (Model.Count() > 0)
    {
        foreach (var item in Model)
        {
            if (item.TripSchedule.DepartureTime > DateTime.Now)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.Trip.CodeName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.DepartureTime)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.Trip.Origin)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.Trip.Destination)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.Trip.Vehicle.TypeofVehicle.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TripSchedule.Trip.Vehicle.Code)
                    </td>
                    <td>
                        @item.TripSchedule.Trip.Routes.Max(r => r.Distance) km
                    </td>
                    <td>
                        @if (item.Stations.Count > 2)
                        {
                            <span>
                                @(item.TripSchedule.Trip.Routes.Max(r => r.Duration) + (item.Stations.Count - 2) * 7) mins
                            </span>
                        }
                        else
                        {
                            <span>
                                @(@item.TripSchedule.Trip.Routes.Max(r => r.Duration)) mins
                            </span>
                        }
                    </td>
                    <td>
                        @item.Stations.Count()
                    </td>
                    <td>
                        <button class="btn btn-success">@Html.ActionLink("Select", "Details", new { id = item.TripSchedule.TripScheduleID })</button>
                    </td>
                </tr>
            }

        }
    }
    </table>

<div id="not_found" class="not_found" style="display: none"> NOT FOUND </div>

    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
    $("#Origin").on('change', function () {
        $('#Destination').children().remove().end();
        jQuery("#Origin option").each(function () {
            if (jQuery(this).val() != $('#Origin').val()) {
                if ($(this).val() != "") {
                    $('#Destination').append('<option value=' + jQuery(this).val() + '>' + jQuery(this).text() + '</option>');
                }
            }
        });
    });
    var table = document.getElementById("triptable");
    var rowCount = table.rows.length;
    var not_found = document.getElementById("not_found");
    if (rowCount<2) {
        table.style.display = "none";
        not_found.style.display = "block";
    }
</script>